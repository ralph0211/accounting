Imports System.Data
Imports System.Data.SqlClient

Partial Class QuestCredit_AutoSave
    Inherits System.Web.UI.Page

    Private Sub QuestCredit_AutoSave_Load(sender As Object, e As EventArgs) Handles Me.Load
        Dim txt = ""
        Try
            Dim username = Request.Form("username"), pag = Request.Form("page"), SessionID = Request.Form("SessionID")
            If pag = "NamesCapture.aspx" Then
                If isSavedSession(SessionID) Then
                    'update
                    Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                        Using cmd = New SqlCommand("update CUSTOMER_DETAILS_AutoSave set [CUSTOMER_TYPE]='" & Request.Form("rdbClientType") & "',[SUB_INDIVIDUAL]='" & Request.Form("rdbSubIndividual") & "',[CUSTOMER_NUMBER]='" & Request.Form("custNo") & "',[SURNAME]='" & BankString.removeSpecialCharacter(Request.Form("surname")) & "',[FORENAMES]='" & BankString.removeSpecialCharacter(Request.Form("forenames")) & "',[DOB]=NULLIF('" & Request.Form("dob") & "',''),[IDNO]='" & Request.Form("idno") & "',[ISSUE_DATE]=NULLIF('" & Request.Form("issDate") & "',''),[ADDRESS]='" & BankString.removeSpecialCharacter(Request.Form("address")) & "',[CITY]='" & BankString.removeSpecialCharacter(Request.Form("city")) & "',[PHONE_NO]='" & Request.Form("phoneNo") & "',[NATIONALITY]='" & BankString.removeSpecialCharacter(Request.Form("nationality")) & "',[GENDER]='" & Request.Form("rdbGender") & "',[HOME_TYPE]='" & Request.Form("rdbHouse") & "',[MONTHLY_RENT]=NULLIF('" & Request.Form("rent") & "',''),[MARITAL_STATUS]='" & Request.Form("cmbMaritalStatus") & "',[EDUCATION]='" & Request.Form("cmbEducation") & "',[CURR_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("currEmployer")) & "',[CURR_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("empAddress")) & "',[CURR_EMP_LENGTH]=NULLIF('" & Request.Form("empHowLong") & "',''),[CURR_EMP_PHONE]='" & Request.Form("empPhone") & "',[CURR_EMP_EMAIL]='" & Request.Form("empEmail") & "',[CURR_EMP_FAX]='" & Request.Form("empFax") & "',[CURR_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("empCity")) & "',[CURR_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("empPosition")) & "',[CURR_EMP_SALARY]=NULLIF('" & Request.Form("empSalary") & "',''),[CURR_EMP_NET]=NULLIF('" & Request.Form("empSalaryNet") & "',''),[CURR_EMP_INCOME]=NULLIF('" & Request.Form("empOtherIncome") & "',''),[PREV_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("prevEmployer")) & "',[PREV_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpAddress")) & "',[PREV_EMP_LENGTH]=NULLIF('" & Request.Form("prevEmpHowLong") & "',''),[PREV_EMP_PHONE]='" & Request.Form("prevEmpPhone") & "',[PREV_EMP_EMAIL]='" & Request.Form("prevEmpEmail") & "',[PREV_EMP_FAX]='" & Request.Form("prevEmpFax") & "',[PREV_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpCity.Text")) & "',[PREV_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpPosition")) & "',[PREV_EMP_SALARY]=NULLIF('" & Request.Form("prevEmpSalary") & "',''),[PREV_EMP_NET]=NULLIF('" & Request.Form("prevEmpSalaryNet") & "',''),[PREV_EMP_INCOME]=NULLIF('" & Request.Form("prevEmpAnnualIncome") & "',''),[SPOUSE_NAME]='" & BankString.removeSpecialCharacter(Request.Form("spouse")) & "',[SPOUSE_OCCUPATION]='" & BankString.removeSpecialCharacter(Request.Form("spouseOccupation")) & "',[SPOUSE_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("spouseEmployer")) & "',[NO_CHILDREN]=NULLIF('" & Request.Form("noChildren") & "',''),[NO_DEPENDANTS]=NULLIF('" & Request.Form("noDependant") & "',''),[TRADE_REF1]='" & Request.Form("tradeRef1") & "',[TRADE_REF2]='" & Request.Form("tradeRef2") & "',[MODIFIED_BY]='" & Session("UserID") & "',[MODIFIED_DATE]=GETDATE(),[SPOUSE_PHONE]='" & Request.Form("spousePhone") & "',[BRANCH_CODE]='" & Request.Form("lblBranchCode") & "',[BRANCH_NAME]='" & BankString.removeSpecialCharacter(Request.Form("lblBranchName")) & "',[AREA]='" & Request.Form("cmbArea") & "',[ECNO]='" & Request.Form("ecno") & "',[CD]='" & Request.Form("ecnocd") & "',PDACode='" & Request.Form("cmbPDAAppType") & "',AppTypeBank='" & Request.Form("cmbBankAppType") & "',AppTypeBranch='" & Request.Form("cmbBranchAppType") & "',AppTypeOtherDesc='" & Request.Form("otherAppType") & "',[AutoSaveDate]=GETDATE(),[Operation]='" & Request.Form("action") & "' where [SessionID]='" & SessionID & "'", con)
                            con.Open()
                            txt = cmd.CommandText
                            cmd.ExecuteNonQuery()
                            con.Close()
                        End Using
                    End Using
                Else
                    'insert
                    Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                        Using cmd = New SqlCommand("insert into CUSTOMER_DETAILS_AutoSave ([CUSTOMER_TYPE],[SUB_INDIVIDUAL],[CUSTOMER_NUMBER],[SURNAME],[FORENAMES],[DOB],[IDNO],[ISSUE_DATE],[ADDRESS],[CITY],[PHONE_NO],[NATIONALITY],[GENDER],[HOME_TYPE],[MONTHLY_RENT],[MARITAL_STATUS],[EDUCATION],[CURR_EMPLOYER],[CURR_EMP_ADD],[CURR_EMP_LENGTH],[CURR_EMP_PHONE],[CURR_EMP_EMAIL],[CURR_EMP_FAX],[CURR_EMP_CITY],[CURR_EMP_POSITION],[CURR_EMP_SALARY],[CURR_EMP_NET],[CURR_EMP_INCOME],[PREV_EMPLOYER],[PREV_EMP_ADD],[PREV_EMP_LENGTH],[PREV_EMP_PHONE],[PREV_EMP_EMAIL],[PREV_EMP_FAX],[PREV_EMP_CITY],[PREV_EMP_POSITION],[PREV_EMP_SALARY],[PREV_EMP_NET],[PREV_EMP_INCOME],[SPOUSE_NAME],[SPOUSE_OCCUPATION],[SPOUSE_EMPLOYER],[NO_CHILDREN],[NO_DEPENDANTS],[TRADE_REF1],[TRADE_REF2],[CREATED_BY],[CREATED_DATE],[MODIFIED_BY],[MODIFIED_DATE],[SPOUSE_PHONE],[BRANCH_CODE],[BRANCH_NAME],[AREA],[ECNO],[CD],PDACode,AppTypeBank,AppTypeBranch,AppTypeOtherDesc,[SessionID],[SavedBy],[AutoSaveDate],[Operation]) values ('" & Request.Form("rdbClientType") & "','" & Request.Form("rdbSubIndividual") & "','" & Request.Form("custNo") & "','" & BankString.removeSpecialCharacter(Request.Form("surname")) & "','" & BankString.removeSpecialCharacter(Request.Form("forenames")) & "',NULLIF('" & Request.Form("dob") & "',''),'" & Request.Form("idno") & "',NULLIF('" & Request.Form("issDate") & "',''),'" & BankString.removeSpecialCharacter(Request.Form("address")) & "','" & BankString.removeSpecialCharacter(Request.Form("city")) & "','" & Request.Form("phoneNo") & "','" & BankString.removeSpecialCharacter(Request.Form("nationality")) & "','" & Request.Form("rdbGender") & "','" & Request.Form("rdbHouse") & "',NULLIF('" & Request.Form("rent") & "',''),'" & Request.Form("cmbMaritalStatus") & "','" & Request.Form("cmbEducation") & "','" & BankString.removeSpecialCharacter(Request.Form("currEmployer")) & "','" & BankString.removeSpecialCharacter(Request.Form("empAddress")) & "',NULLIF('" & Request.Form("empHowLong") & "',''),'" & Request.Form("empPhone") & "','" & Request.Form("empEmail") & "','" & Request.Form("empFax") & "','" & BankString.removeSpecialCharacter(Request.Form("empCity")) & "','" & BankString.removeSpecialCharacter(Request.Form("empPosition")) & "',NULLIF('" & Request.Form("empSalary") & "',''),NULLIF('" & Request.Form("empSalaryNet") & "',''),NULLIF('" & Request.Form("empOtherIncome") & "',''),'" & BankString.removeSpecialCharacter(Request.Form("prevEmployer")) & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpAddress")) & "',NULLIF('" & Request.Form("prevEmpHowLong") & "',''),'" & Request.Form("prevEmpPhone") & "','" & Request.Form("prevEmpEmail") & "','" & Request.Form("prevEmpFax") & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpCity.Text")) & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpPosition")) & "',NULLIF('" & Request.Form("prevEmpSalary") & "',''),NULLIF('" & Request.Form("prevEmpSalaryNet") & "',''),NULLIF('" & Request.Form("prevEmpAnnualIncome") & "',''),'" & BankString.removeSpecialCharacter(Request.Form("spouse")) & "','" & BankString.removeSpecialCharacter(Request.Form("spouseOccupation")) & "','" & BankString.removeSpecialCharacter(Request.Form("spouseEmployer")) & "',NULLIF('" & Request.Form("noChildren") & "',''),NULLIF('" & Request.Form("noDependant") & "',''),'" & Request.Form("tradeRef1") & "','" & Request.Form("tradeRef2") & "','" & Session("UserID") & "',getdate(),'','','" & Request.Form("spousePhone") & "','" & Request.Form("lblBranchCode") & "','" & BankString.removeSpecialCharacter(Request.Form("lblBranchName")) & "','" & Request.Form("cmbArea") & "','" & Request.Form("ecno") & "','" & Request.Form("ecnocd") & "','" & Request.Form("cmbPDAAppType") & "','" & Request.Form("cmbBankAppType") & "','" & Request.Form("cmbBranchAppType") & "','" & Request.Form("otherAppType") & "','" & SessionID & "','" & username & "',GETDATE(),'" & Request.Form("action") & "')", con)
                            con.Open()
                            cmd.ExecuteNonQuery()
                            con.Close()
                        End Using
                    End Using
                End If
            ElseIf pag = "ApplicationForm.aspx" Then
                If Trim(Request.Form("custNo")) <> "" Then
                    If isSavedSessionApp(SessionID) Then
                        'update
                        Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                            Using cmd = New SqlCommand("update QUEST_APPLICATION_AutoSave set [ApplicationType]=NULLIF('" & Request.Form("rdbType") & "',''),[CUSTOMER_TYPE]='" & Request.Form("rdbClientType") & "',[SUB_INDIVIDUAL]='" & Request.Form("rdbSubIndividual") & "',[CUSTOMER_NUMBER]='" & Request.Form("custNo") & "',[SURNAME]='" & BankString.removeSpecialCharacter(Request.Form("surname")) & "',[FORENAMES]='" & BankString.removeSpecialCharacter(Request.Form("forenames")) & "',[DOB]='" & Request.Form("dob") & "',[IDNO]='" & Request.Form("idno") & "',[ISSUE_DATE]='" & Request.Form("issDate") & "',[ADDRESS]='" & BankString.removeSpecialCharacter(Request.Form("address")) & "',[CITY]='" & BankString.removeSpecialCharacter(Request.Form("city")) & "',[PHONE_NO]='" & Request.Form("phoneNo") & "',[NATIONALITY]='" & BankString.removeSpecialCharacter(Request.Form("nationality")) & "',[GENDER]='" & Request.Form("rdbGender") & "',[HOME_TYPE]='" & Request.Form("rdbHouse") & "',[MONTHLY_RENT]=NULLIF('" & Request.Form("rent") & "',''),[HOME_LENGTH]=NULLIF('" & Request.Form("houseHowLong") & "',''),[MARITAL_STATUS]='" & Request.Form("cmbMaritalStatus") & "',[EDUCATION]='" & Request.Form("cmbEducation") & "',[CURR_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("currEmployer")) & "',[CURR_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("empAddress")) & "',[CURR_EMP_LENGTH]=NULLIF('" & Request.Form("empHowLong") & "',''),[CURR_EMP_PHONE]='" & Request.Form("empPhone") & "',[CURR_EMP_EMAIL]='" & Request.Form("empEmail") & "',[CURR_EMP_FAX]='" & Request.Form("empFax") & "',[CURR_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("empCity")) & "',[CURR_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("empPosition")) & "',[CURR_EMP_SALARY]=NULLIF('" & Request.Form("empSalary") & "',''),[CURR_EMP_NET]=NULLIF('" & Request.Form("empSalaryNet") & "',''),[CURR_EMP_INCOME]=NULLIF('" & Request.Form("empOtherIncome") & "',''),[PREV_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("prevEmployer")) & "',[PREV_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpAddress")) & "',[PREV_EMP_LENGTH]='" & Request.Form("prevEmpHowLong") & "',[PREV_EMP_PHONE]='" & Request.Form("prevEmpPhone") & "',[PREV_EMP_EMAIL]='" & Request.Form("prevEmpEmail") & "',[PREV_EMP_FAX]='" & Request.Form("prevEmpFax") & "',[PREV_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpCity")) & "',[PREV_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpPosition")) & "',[PREV_EMP_SALARY]=NULLIF('" & Request.Form("prevEmpSalary") & "',''),[PREV_EMP_NET]=NULLIF('" & Request.Form("prevEmpSalaryNet") & "',''),[PREV_EMP_INCOME]=NULLIF('" & Request.Form("prevEmpAnnualIncome") & "',''),[SPOUSE_NAME]='" & BankString.removeSpecialCharacter(Request.Form("spouse")) & "',[SPOUSE_OCCUPATION]='" & BankString.removeSpecialCharacter(Request.Form("spouseOccupation")) & "',[SPOUSE_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("spouseEmployer")) & "',[NO_CHILDREN]=NULLIF('" & Trim(Request.Form("noChildren")) & "',''),[NO_DEPENDANTS]=NULLIF('" & Trim(Request.Form("noDependant")) & "',''),[TRADE_REF1]='" & Request.Form("tradeRef1") & "',[TRADE_REF2]='" & Request.Form("tradeRef2") & "',[GUARANTOR_NAME]='" & BankString.removeSpecialCharacter(Request.Form("guarName")) & "',[GUARANTOR_DOB]='" & Request.Form("guarDOB") & "',[GUARANTOR_IDNO]='" & Request.Form("guarIDNo") & "',[GUARANTOR_PHONE]='" & Request.Form("guarPhone") & "',[GUARANTOR_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarCurrAdd")) & "',[GUARANTOR_CITY]='" & BankString.removeSpecialCharacter(Request.Form("guarCity")) & "',[GUARANTOR_HOME_TYPE]='" & Request.Form("rdbGuarHomeType") & "',[GUARANTOR_RENT]=NULLIF('" & Trim(Request.Form("guarMonthRent")) & "',''),[GUARANTOR_HOME_LENGTH]=NULLIF('" & Trim(Request.Form("guarHomeLength")) & "',''),[GUARANTOR_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("guarCurrEmp")) & "',[GUARANTOR_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpAdd")) & "',[GUARANTOR_EMP_LENGTH]=NULLIF('" & Request.Form("guarEmpLength") & "',''),[GUARANTOR_EMP_PHONE]='" & Request.Form("guarEmpPhone") & "',[GUARANTOR_EMP_EMAIL]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpEmail")) & "',[GUARANTOR_EMP_FAX]='" & Request.Form("guarEmpFax") & "',[GUARANTOR_EMP_POSTN]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpPosition")) & "',[GUARANTOR_EMP_SALARY]=NULLIF('" & Request.Form("guarEmpSalary") & "',''),[GUARANTOR_EMP_INCOME]=NULLIF('" & Request.Form("guarEmpIncome") & "',''),[GUARANTOR_REL_NAME]='" & BankString.removeSpecialCharacter(Request.Form("guarNameRelative")) & "',[GUARANTOR_REL_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarRelAddress")) & "',[GUARANTOR_REL_CITY]='" & BankString.removeSpecialCharacter(Request.Form("guarRelCity")) & "',[GUARANTOR_REL_PHONE]='" & Request.Form("guarRelPhone") & "',[GUARANTOR_REL_RELTNSHP]='" & BankString.removeSpecialCharacter(Request.Form("guarRelReltnship")) & "',[FIN_AMT]=NULLIF('" & Request.Form("finReqAmt").Replace(",", "") & "',''),[FIN_TENOR]=NULLIF('" & Request.Form("finReqTenor") & "',''),[FIN_INT_RATE]=NULLIF('" & Request.Form("finReqIntRate") & "',''),[FIN_PURPOSE]='" & BankString.removeSpecialCharacter(Request.Form("cmbFinReqPurpose")) & "',[FIN_SRC_REPAYMT]='" & BankString.removeSpecialCharacter(Request.Form("finReqSource")) & "',[FIN_SEC_OFFER]='" & BankString.removeSpecialCharacter(Request.Form("finReqSecOffer")) & "',[FIN_BANK]='" & BankString.removeSpecialCharacter(Request.Form("finReqBank")) & "',[FIN_BRANCH]='" & BankString.removeSpecialCharacter(Request.Form("finReqBranchName")) & "',[FIN_BRANCH_CODE]='" & Request.Form("finReqBranchCode") & "',[FIN_ACCNO]='" & Request.Form("finReqAccNo") & "',[FIN_REPAY_DATE]='" & Request.Form("finReqRepaymt") & "',[OTHER_DESC]='" & BankString.removeSpecialCharacter(Request.Form("otherDesc")) & "',[OTHER_ACCNO]='" & Request.Form("otherAccNo") & "',[OTHER_AMT]=NULLIF('" & Request.Form("otherAmt") & "',''),[QUES_HOW]='" & Request.Form("rdbQuesHow") & "',[QUES_EMPLOYEE]='" & BankString.removeSpecialCharacter(Request.Form("quesEmployee")) & "',[QUES_AGENT]='" & BankString.removeSpecialCharacter(Request.Form("quesAgent")) & "',[MODIFIED_BY]='" & Session("UserID") & "',[MODIFIED_DATE]=getdate(),[BRANCH_CODE]='" & Request.Form("lblBranchCode") & "',[BRANCH_NAME]='" & BankString.removeSpecialCharacter(Request.Form("lblBranchName")) & "',[AREA]='" & Request.Form("cmbArea") & "',[AMT_APPLIED]=NULLIF('" & Request.Form("finReqAmt").Replace(",", "") & "',''),[ECOCASH_NUMBER]='" & Request.Form("ecocashNumber") & "',[OTHER_CHARGES]=NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),[FIN_ADMIN]=NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),[DISBURSE_OPTION]='',[MIN_DEPT]='" & Request.Form("minDept") & "',[MIN_DEPT_NO]='" & Request.Form("minDeptNo") & "',[ECNO]='" & Request.Form("ecno") & "',[CD]='" & Request.Form("ecnocd") & "',INT_RATE=NULLIF('" & Request.Form("interestRate") & "',''),INSURANCE_RATE=NULLIF('" & Request.Form("insuranceRate") & "',''),ADMIN_RATE=NULLIF('" & Request.Form("adminRate") & "',''),PDACode='" & Request.Form("cmbPDAAppType") & "',AppTypeBank='" & Request.Form("cmbBankAppType") & "',AppTypeBranch='" & Request.Form("cmbBranchAppType") & "',AppTypeOtherDesc='" & Request.Form("otherAppType") & "' where [SessionID]='" & SessionID & "'", con)
                                'Using cmd = New SqlCommand("update QUEST_APPLICATION_AutoSave set [ApplicationType]='" & Request.Form("rdbType") & "',[ASSET_NAME]='" & Request.Form("ddlAssets").Replace("'", "''") & "',[CUSTOMER_TYPE]='" & Request.Form("rdbClientType") & "',[SUB_INDIVIDUAL]='" & Request.Form("rdbSubIndividual") & "',[CUSTOMER_NUMBER]='" & Request.Form("custNo") & "',[SURNAME]='" & BankString.removeSpecialCharacter(Request.Form("surname")) & "',[FORENAMES]='" & BankString.removeSpecialCharacter(Request.Form("forenames")) & "',[DOB]='" & Request.Form("dob") & "',[IDNO]='" & Request.Form("idno") & "',[ISSUE_DATE]='" & Request.Form("issDate") & "',[ADDRESS]='" & BankString.removeSpecialCharacter(Request.Form("address")) & "',[CITY]='" & BankString.removeSpecialCharacter(Request.Form("city")) & "',[PHONE_NO]='" & Request.Form("phoneNo") & "',[NATIONALITY]='" & BankString.removeSpecialCharacter(Request.Form("nationality")) & "',[GENDER]='" & Request.Form("rdbGender") & "',[HOME_TYPE]='" & Request.Form("rdbHouse") & "',[MONTHLY_RENT]='" & Request.Form("rent") & "',[HOME_LENGTH]='" & Request.Form("houseHowLong") & "',[MARITAL_STATUS]='" & Request.Form("cmbMaritalStatus") & "',[EDUCATION]='" & Request.Form("cmbEducation") & "',[CURR_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("currEmployer")) & "',[CURR_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("empAddress")) & "',[CURR_EMP_LENGTH]='" & Request.Form("empHowLong") & "',[CURR_EMP_PHONE]='" & Request.Form("empPhone") & "',[CURR_EMP_EMAIL]='" & Request.Form("empEmail") & "',[CURR_EMP_FAX]='" & Request.Form("empFax") & "',[CURR_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("empCity")) & "',[CURR_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("empPosition")) & "',[CURR_EMP_SALARY]='" & Request.Form("empSalary") & "',[CURR_EMP_NET]='" & Request.Form("empSalaryNet") & "',[CURR_EMP_INCOME]='" & Request.Form("empOtherIncome") & "',[PREV_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("prevEmployer")) & "',[PREV_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpAddress")) & "',[PREV_EMP_LENGTH]='" & Request.Form("prevEmpHowLong") & "',[PREV_EMP_PHONE]='" & Request.Form("prevEmpPhone") & "',[PREV_EMP_EMAIL]='" & Request.Form("prevEmpEmail") & "',[PREV_EMP_FAX]='" & Request.Form("prevEmpFax") & "',[PREV_EMP_CITY]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpCity")) & "',[PREV_EMP_POSITION]='" & BankString.removeSpecialCharacter(Request.Form("prevEmpPosition")) & "',[PREV_EMP_SALARY]='" & Request.Form("prevEmpSalary") & "',[PREV_EMP_NET]='" & Request.Form("prevEmpSalaryNet") & "',[PREV_EMP_INCOME]='" & Request.Form("prevEmpAnnualIncome") & "',[SPOUSE_NAME]='" & BankString.removeSpecialCharacter(Request.Form("spouse")) & "',[SPOUSE_OCCUPATION]='" & BankString.removeSpecialCharacter(Request.Form("spouseOccupation")) & "',[SPOUSE_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("spouseEmployer")) & "',[NO_CHILDREN]=NULLIF('" & Trim(Request.Form("noChildren")) & "',''),[NO_DEPENDANTS]=NULLIF('" & Trim(Request.Form("noDependant")) & "',''),[TRADE_REF1]='" & Request.Form("tradeRef1") & "',[TRADE_REF2]='" & Request.Form("tradeRef2") & "',[GUARANTOR_NAME]='" & BankString.removeSpecialCharacter(Request.Form("guarName")) & "',[GUARANTOR_DOB]='" & Request.Form("guarDOB") & "',[GUARANTOR_IDNO]='" & Request.Form("guarIDNo") & "',[GUARANTOR_PHONE]='" & Request.Form("guarPhone") & "',[GUARANTOR_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarCurrAdd")) & "',[GUARANTOR_CITY]='" & BankString.removeSpecialCharacter(Request.Form("guarCity")) & "',[GUARANTOR_HOME_TYPE]='" & Request.Form("rdbGuarHomeType") & "',[GUARANTOR_RENT]=NULLIF('" & Trim(Request.Form("guarMonthRent")) & "',''),[GUARANTOR_HOME_LENGTH]=NULLIF('" & Trim(Request.Form("guarHomeLength")) & "',''),[GUARANTOR_EMPLOYER]='" & BankString.removeSpecialCharacter(Request.Form("guarCurrEmp")) & "',[GUARANTOR_EMP_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpAdd")) & "',[GUARANTOR_EMP_LENGTH]='" & Request.Form("guarEmpLength") & "',[GUARANTOR_EMP_PHONE]='" & Request.Form("guarEmpPhone") & "',[GUARANTOR_EMP_EMAIL]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpEmail")) & "',[GUARANTOR_EMP_FAX]='" & Request.Form("guarEmpFax") & "',[GUARANTOR_EMP_POSTN]='" & BankString.removeSpecialCharacter(Request.Form("guarEmpPosition")) & "',[GUARANTOR_EMP_SALARY]='" & Request.Form("guarEmpSalary") & "',[GUARANTOR_EMP_INCOME]='" & Request.Form("guarEmpIncome") & "',[GUARANTOR_REL_NAME]='" & BankString.removeSpecialCharacter(Request.Form("guarNameRelative")) & "',[GUARANTOR_REL_ADD]='" & BankString.removeSpecialCharacter(Request.Form("guarRelAddress")) & "',[GUARANTOR_REL_CITY]='" & BankString.removeSpecialCharacter(Request.Form("guarRelCity")) & "',[GUARANTOR_REL_PHONE]='" & Request.Form("guarRelPhone") & "',[GUARANTOR_REL_RELTNSHP]='" & BankString.removeSpecialCharacter(Request.Form("guarRelReltnship")) & "',[FIN_AMT]='" & Request.Form("finReqAmt").Replace(",", "") & "',[FIN_TENOR]='" & Request.Form("finReqTenor") & "',[FIN_INT_RATE]='" & Request.Form("finReqIntRate") & "',[FIN_PURPOSE]='" & BankString.removeSpecialCharacter(Request.Form("cmbFinReqPurpose")) & "',[FIN_SRC_REPAYMT]='" & BankString.removeSpecialCharacter(Request.Form("finReqSource")) & "',[FIN_SEC_OFFER]='" & BankString.removeSpecialCharacter(Request.Form("finReqSecOffer")) & "',[FIN_BANK]='" & BankString.removeSpecialCharacter(Request.Form("finReqBank")) & "',[FIN_BRANCH]='" & BankString.removeSpecialCharacter(Request.Form("finReqBranchName")) & "',[FIN_BRANCH_CODE]='" & Request.Form("finReqBranchCode") & "',[FIN_ACCNO]='" & Request.Form("finReqAccNo") & "',[FIN_REPAY_DATE]='" & Request.Form("finReqRepaymt") & "',[OTHER_DESC]='" & BankString.removeSpecialCharacter(Request.Form("otherDesc")) & "',[OTHER_ACCNO]='" & Request.Form("otherAccNo") & "',[OTHER_AMT]='" & Request.Form("otherAmt") & "',[QUES_HOW]='" & Request.Form("rdbQuesHow") & "',[QUES_EMPLOYEE]='" & BankString.removeSpecialCharacter(Request.Form("quesEmployee")) & "',[QUES_AGENT]='" & BankString.removeSpecialCharacter(Request.Form("quesAgent")) & "',[MODIFIED_BY]='" & Session("UserID") & "',[MODIFIED_DATE]=getdate(),[BRANCH_CODE]='" & Request.Form("lblBranchCode") & "',[BRANCH_NAME]='" & BankString.removeSpecialCharacter(Request.Form("lblBranchName")) & "',[AREA]='" & Request.Form("cmbArea") & "',[AMT_APPLIED]='" & Request.Form("finReqAmt").Replace(",", "") & "',[ECOCASH_NUMBER]='" & Request.Form("ecocashNumber") & "',[OTHER_CHARGES]=NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),[FIN_ADMIN]=NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),[DISBURSE_OPTION]='',[MIN_DEPT]='" & Request.Form("minDept") & "',[MIN_DEPT_NO]='" & Request.Form("minDeptNo") & "',[ECNO]='" & Request.Form("ecno") & "',[CD]='" & Request.Form("ecnocd") & "',INT_RATE='" & Request.Form("interestRate") & "',INSURANCE_RATE='" & Request.Form("insuranceRate") & "',ADMIN_RATE='" & Request.Form("adminRate") & "',PDACode='" & Request.Form("cmbPDAAppType") & "',AppTypeBank='" & Request.Form("cmbBankAppType") & "',AppTypeBranch='" & Request.Form("cmbBranchAppType") & "',AppTypeOtherDesc='" & Request.Form("otherAppType") & "' where [SessionID]='" & SessionID & "'", con)
                                'Using cmd = New SqlCommand("update QUEST_APPLICATION_AutoSave set [ApplicationType]='" & Request.Form("rdbType") & "',[ASSET_NAME]='" & Request.Form("ddlAssets").Replace("'", "''") & "',[CUSTOMER_TYPE]='" & Request.Form("rdbClientType") & "'", con)
                                con.Open()
                                txt = cmd.CommandText
                                cmd.ExecuteNonQuery()
                                con.Close()
                            End Using
                        End Using
                    Else
                        'insert
                        Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                            Using cmd = New SqlCommand("insert into QUEST_APPLICATION_AutoSave ([ApplicationType],[ASSET_NAME],[CUSTOMER_TYPE],[SUB_INDIVIDUAL],[CUSTOMER_NUMBER],[SURNAME],[FORENAMES],[DOB],[IDNO],[ISSUE_DATE],[ADDRESS],[CITY],[PHONE_NO],[NATIONALITY],[GENDER],[HOME_TYPE],[MONTHLY_RENT],[HOME_LENGTH],[MARITAL_STATUS],[EDUCATION],[CURR_EMPLOYER],[CURR_EMP_ADD],[CURR_EMP_LENGTH],[CURR_EMP_PHONE],[CURR_EMP_EMAIL],[CURR_EMP_FAX],[CURR_EMP_CITY],[CURR_EMP_POSITION],[CURR_EMP_SALARY],[CURR_EMP_NET],[CURR_EMP_INCOME],[PREV_EMPLOYER],[PREV_EMP_ADD],[PREV_EMP_LENGTH],[PREV_EMP_PHONE],[PREV_EMP_EMAIL],[PREV_EMP_FAX],[PREV_EMP_CITY],[PREV_EMP_POSITION],[PREV_EMP_SALARY],[PREV_EMP_NET],[PREV_EMP_INCOME],[SPOUSE_NAME],[SPOUSE_OCCUPATION],[SPOUSE_EMPLOYER],[NO_CHILDREN],[NO_DEPENDANTS],[TRADE_REF1],[TRADE_REF2],[GUARANTOR_NAME],[GUARANTOR_DOB],[GUARANTOR_IDNO],[GUARANTOR_PHONE],[GUARANTOR_ADD],[GUARANTOR_CITY],[GUARANTOR_HOME_TYPE],[GUARANTOR_RENT],[GUARANTOR_HOME_LENGTH],[GUARANTOR_EMPLOYER],[GUARANTOR_EMP_ADD],[GUARANTOR_EMP_LENGTH],[GUARANTOR_EMP_PHONE],[GUARANTOR_EMP_EMAIL],[GUARANTOR_EMP_FAX],[GUARANTOR_EMP_POSTN],[GUARANTOR_EMP_SALARY],[GUARANTOR_EMP_INCOME],[GUARANTOR_REL_NAME],[GUARANTOR_REL_ADD],[GUARANTOR_REL_CITY],[GUARANTOR_REL_PHONE],[GUARANTOR_REL_RELTNSHP],[FIN_AMT],[FIN_TENOR],[FIN_INT_RATE],[FIN_PURPOSE],[FIN_SRC_REPAYMT],[FIN_SEC_OFFER],[FIN_BANK],[FIN_BRANCH],[FIN_BRANCH_CODE],[FIN_ACCNO],[FIN_REPAY_DATE],[OTHER_DESC],[OTHER_ACCNO],[OTHER_AMT],[QUES_HOW],[QUES_EMPLOYEE],[QUES_AGENT],[APPL_SIGNATURE],[APPL_DATE],[JOINT_APPL_SIGNATURE],[APP1_APPROVED],[RECOMMENDED_AMT],[APP1_SIGNATURE],[APP2_APPROVED],[APPROVED_AMT],[APP2_SIGNATURE],[INSTALLMENT],[PERIOD],[CREATED_BY],[CREATED_DATE],[MODIFIED_BY],[MODIFIED_DATE],[STATUS],[SEND_TO],[BRANCH_CODE],[BRANCH_NAME],[AREA],[AMT_APPLIED],[ECOCASH_NUMBER],[OTHER_CHARGES],[DISBURSE_OPTION],[MIN_DEPT],[MIN_DEPT_NO],[ECNO],[CD],LO_ID,LAST_ID,INT_RATE,INSURANCE_RATE,ADMIN_RATE,[FIN_ADMIN],PDACode,AppTypeBank,AppTypeBranch,AppTypeOtherDesc,[SessionID],[SavedBy],[AutoSaveDate]) values ('" & BankString.removeSpecialCharacter(Request.Form("rdbType")) & "','" & BankString.removeSpecialCharacter(Request.Form("ddlAssets")) & "','" & Request.Form("rdbClientType") & "','" & Request.Form("rdbSubIndividual") & "','" & Request.Form("custNo") & "','" & BankString.removeSpecialCharacter(Request.Form("surname")) & "','" & BankString.removeSpecialCharacter(Request.Form("forenames")) & "',NULLIF('" & Request.Form("dob") & "',''),'" & Request.Form("idno") & "',NULLIF('" & Request.Form("issDate") & "',''),'" & BankString.removeSpecialCharacter(Request.Form("address")) & "','" & BankString.removeSpecialCharacter(Request.Form("city")) & "','" & Request.Form("phoneNo") & "','" & BankString.removeSpecialCharacter(Request.Form("nationality")) & "','" & Request.Form("gender") & "','" & Request.Form("rdbHouse") & "',NULLIF('" & Trim(Request.Form("rent")) & "',''),NULLIF('" & Trim(Request.Form("houseHowLong")) & "',''),'" & Request.Form("cmbMaritalStatus") & "','" & Request.Form("cmbEducation") & "','" & BankString.removeSpecialCharacter(Request.Form("currEmployer")) & "','" & BankString.removeSpecialCharacter(Request.Form("empAddress")) & "',NULLIF('" & Trim(Request.Form("empHowLong")) & "',''),'" & Request.Form("empPhone") & "','" & Request.Form("empEmail") & "','" & Request.Form("empFax") & "','" & BankString.removeSpecialCharacter(Request.Form("empCity")) & "','" & BankString.removeSpecialCharacter(Request.Form("empPosition")) & "',NULLIF('" & Trim(Request.Form("empSalary")) & "',''),NULLIF('" & Trim(Request.Form("empSalaryNet")) & "',''),NULLIF('" & Trim(Request.Form("empOtherIncome")) & "',''),'" & BankString.removeSpecialCharacter(Request.Form("prevEmployer")) & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpAddress")) & "',NULLIF('" & Trim(Request.Form("prevEmpHowLong")) & "',''),'" & Request.Form("prevEmpPhone") & "','" & Request.Form("prevEmpEmail") & "','" & Request.Form("prevEmpFax") & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpCity")) & "','" & BankString.removeSpecialCharacter(Request.Form("prevEmpPosition")) & "',NULLIF('" & Trim(Request.Form("prevEmpSalary")) & "',''),NULLIF('" & Trim(Request.Form("prevEmpSalaryNet")) & "',''),NULLIF('" & Trim(Request.Form("prevEmpAnnualIncome")) & "',''),'" & BankString.removeSpecialCharacter(Request.Form("spouse")) & "','" & BankString.removeSpecialCharacter(Request.Form("spouseOccupation")) & "','" & BankString.removeSpecialCharacter(Request.Form("spouseEmployer")) & "',NULLIF('" & Trim(Request.Form("noChildren")) & "',''),NULLIF('" & Trim(Request.Form("noDependant")) & "',''),'" & Request.Form("tradeRef1") & "','" & Request.Form("tradeRef2") & "','" & BankString.removeSpecialCharacter(Request.Form("guarName")) & "',NULLIF('" & Request.Form("guarDOB") & "',''),'" & Request.Form("guarIDNo") & "','" & Request.Form("guarPhone") & "','" & BankString.removeSpecialCharacter(Request.Form("guarCurrAdd")) & "','" & BankString.removeSpecialCharacter(Request.Form("guarCity")) & "','" & Request.Form("rdbGuarHomeType") & "',NULLIF('" & Trim(Request.Form("guarMonthRent")) & "',''),NULLIF('" & Trim(Request.Form("guarHomeLength")) & "',''),'" & BankString.removeSpecialCharacter(Request.Form("guarCurrEmp")) & "','" & BankString.removeSpecialCharacter(Request.Form("guarEmpAdd")) & "',NULLIF('" & Trim(Request.Form("guarEmpLength")) & "',''),'" & Request.Form("guarEmpPhone") & "','" & BankString.removeSpecialCharacter(Request.Form("guarEmpEmail")) & "','" & Request.Form("guarEmpFax") & "','" & BankString.removeSpecialCharacter(Request.Form("guarEmpPosition")) & "',NULLIF('" & Trim(Request.Form("guarEmpSalary")) & "',''),NULLIF('" & Trim(Request.Form("guarEmpIncome")) & "',''),'" & BankString.removeSpecialCharacter(Request.Form("guarNameRelative")) & "','" & BankString.removeSpecialCharacter(Request.Form("guarRelAddress")) & "','" & BankString.removeSpecialCharacter(Request.Form("guarRelCity")) & "','" & Request.Form("guarRelPhone") & "','" & BankString.removeSpecialCharacter(Request.Form("guarRelReltnship")) & "',NULLIF('" & Trim(Request.Form("finReqAmt").Replace(",", "")) & "',''),NULLIF('" & Trim(Request.Form("finReqTenor")) & "',''),NULLIF('" & Trim(Request.Form("finReqIntRate")) & "',''),'" & BankString.removeSpecialCharacter(Request.Form("cmbFinReqPurpose")) & "','" & BankString.removeSpecialCharacter(Request.Form("finReqSource")) & "','" & BankString.removeSpecialCharacter(Request.Form("finReqSecOffer")) & "','" & BankString.removeSpecialCharacter(Request.Form("finReqBank")) & "','" & BankString.removeSpecialCharacter(Request.Form("finReqBranchName")) & "','" & Request.Form("finReqBranchCode") & "','" & Request.Form("finReqAccNo") & "',NULLIF('" & Request.Form("finReqRepaymt") & "',''),'" & BankString.removeSpecialCharacter(Request.Form("otherDesc")) & "','" & Request.Form("otherAccNo") & "',NULLIF('" & Trim(Request.Form("otherAmt")) & "',''),'" & Request.Form("rdbQuesHow") & "','" & BankString.removeSpecialCharacter(Request.Form("quesEmployee")) & "','" & BankString.removeSpecialCharacter(Request.Form("quesAgent")) & "','','','','','','','','','','','','" & Session("UserID") & "',getdate(),'','','','','" & Request.Form("lblBranchCode") & "','" & BankString.removeSpecialCharacter(Request.Form("lblBranchName")) & "','" & Request.Form("cmbArea") & "',NULLIF('" & Request.Form("finReqAmt").Replace(",", "") & "',''),'" & Request.Form("ecocashNumber") & "',NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),'','" & Request.Form("minDept") & "','" & Request.Form("minDeptNo") & "','" & Request.Form("ecno") & "','" & Request.Form("ecnocd") & "','" & Session("ID") & "','" & Session("ID") & "',NULLIF('" & Request.Form("interestRate") & "',''),NULLIF('" & Request.Form("insuranceRate") & "',''),NULLIF('" & Request.Form("adminRate") & "',''),NULLIF('" & Trim(Request.Form("finReqOtherCharges")) & "',''),'" & Request.Form("cmbPDAAppType") & "','" & Request.Form("cmbBankAppType") & "','" & Request.Form("cmbBranchAppType") & "','" & Request.Form("otherAppType") & "','" & SessionID & "','" & username & "',GETDATE())", con)
                                con.Open()
                                txt = cmd.CommandText
                                cmd.ExecuteNonQuery()
                                con.Close()
                            End Using
                        End Using
                    End If
                End If
            End If
        Catch ex As Exception
            'ErrorLogging.WriteLogFile(Session("UserId"), Request.Url.ToString & " --- QuestCredit_AutoSave_Load()", ex.ToString & " //////////////////// " & txt)
        End Try
    End Sub

    Protected Function isSavedSession(sessID As String) As Boolean
        Try
            Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                Using cmd As New SqlCommand("select id from [CUSTOMER_DETAILS_Autosave] where [SessionID]=@sess", con)
                    cmd.Parameters.AddWithValue("@sess", sessID)
                    Dim dt As New DataTable
                    Using adp As New SqlDataAdapter(cmd)
                        adp.Fill(dt)
                    End Using
                    If dt.Rows.Count > 0 Then
                        Return True
                    Else
                        Return False
                    End If
                End Using
            End Using
        Catch ex As Exception
            ErrorLogging.WriteLogFile(Session("UserId"), Request.Url.ToString & " --- isSavedSession()", ex.ToString)
            Return False
        End Try
    End Function

    Protected Function isSavedSessionApp(sessID As String) As Boolean
        Try
            Using con As New SqlConnection(ConfigurationManager.ConnectionStrings("Constring").ConnectionString)
                Using cmd As New SqlCommand("select id from [QUEST_APPLICATION_AutoSave] where [SessionID]=@sess", con)
                    cmd.Parameters.AddWithValue("@sess", sessID)
                    Dim dt As New DataTable
                    Using adp As New SqlDataAdapter(cmd)
                        adp.Fill(dt)
                    End Using
                    If dt.Rows.Count > 0 Then
                        Return True
                    Else
                        Return False
                    End If
                End Using
            End Using
        Catch ex As Exception
            ErrorLogging.WriteLogFile(Session("UserId"), Request.Url.ToString & " --- isSavedSessionApp()", ex.ToString)
            Return False
        End Try
    End Function
End Class